<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin - Manage Products</title>
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="style-store.css" />
</head>
<body>
  <header>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="admin.html">Admin</a></li>
      </ul>
    </nav>
  </header>

  <div class="page-container">
    <div class="cart-side">
      <h2>Admin - Manage Products</h2>

      <input id="name" placeholder="Product Name" />
      <input id="price" placeholder="Price in Pesewas (e.g. 8500)" />
      <input id="image" placeholder="Image URL" />
      <button id="addProductBtn" class="btn">‚ûï Add Product</button>

      <hr style="margin: 20px 0;">

      <button id="loadSamplesBtn" class="btn">üì¶ Load Sample Products</button>

      <div id="productList" style="margin-top: 30px;"></div>
    </div>
  </div>

  <script type="module">
    // Firebase setup
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      deleteDoc,
      doc,
      query,
      where
    } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAn_QB-tl2nUFkHXwdlEh7G_REUI5_rO6U",
      authDomain: "gabbytrial-4a9a9.firebaseapp.com",
      projectId: "gabbytrial-4a9a9",
      storageBucket: "gabbytrial-4a9a9.appspot.com",
      messagingSenderId: "507301585683",
      appId: "1:507301585683:web:0fce82879396f8366db0e6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const productRef = collection(db, "products");

    // Add single product
    document.getElementById('addProductBtn').onclick = async () => {
      const name = document.getElementById('name').value.trim();
      const price = parseInt(document.getElementById('price').value);
      const image = document.getElementById('image').value.trim();

      if (!name || !price || !image) return alert('Fill all fields correctly');

      await addDoc(productRef, { name, price, image });
      alert('‚úÖ Product added');
      loadProducts();
    };

    // Load all products
    async function loadProducts() {
      const list = document.getElementById('productList');
      list.innerHTML = '';
      const snapshot = await getDocs(productRef);
      snapshot.forEach(docSnap => {
        const data = docSnap.data();
        const div = document.createElement('div');
        div.innerHTML = `
          <p><strong>${data.name}</strong> - GHS ${(data.price / 100).toFixed(2)}</p>
          <img src="${data.image}" style="width:100px; height:80px; object-fit:cover; border-radius:5px;" />
          <button class="btn" style="margin-top:5px;" onclick="deleteProduct('${docSnap.id}')">‚ùå Delete</button>
          <hr>
        `;
        list.appendChild(div);
      });
    }

    // Delete product
    window.deleteProduct = async (id) => {
      await deleteDoc(doc(db, "products", id));
      alert('üóëÔ∏è Deleted');
      loadProducts();
    };

    // Load sample products
    document.getElementById('loadSamplesBtn').onclick = async () => {
      const samples = [
        { name: "Men's Running Shoes", price: 12000, image: "images/p1.jpg" },
        { name: "Women's Sneakers", price: 9500, image: "images/p2b.webp" },
        { name: "Cocoa Butter Cream", price: 8000, image: "images/p3.webp" },
        { name: "Casual Loafers", price: 7500, image: "images/p4.avif" },
        { name: "Ladies‚Äô Flats", price: 6500, image: "images/p5.jpg" },
        { name: "Leather Boots", price: 15000, image: "images/p6.jpg" },
        { name: "Men's Sandals", price: 4000, image: "images/p7.jpg" },
        { name: "Kids' Sports Shoes", price: 5500, image: "images/p8.webp" },
        { name: "Formal Dress Shoes", price: 13000, image: "images/p9.jpeg" },
        { name: "Men‚Äôs Slippers", price: 4500, image: "images/p10.avif" },
        { name: "Ankle Boots", price: 14000, image: "images/p11.avif" },
        { name: "Sports Trainers", price: 10000, image: "images/p12.jpg" },
        { name: "Women‚Äôs Heels", price: 8500, image: "images/p13.jpg" },
        { name: "Winter Boots", price: 16000, image: "images/p14.jpg" }
      ];

      for (const p of samples) {
        const qSnap = await getDocs(query(productRef, where("name", "==", p.name)));
        if (qSnap.empty) {
          await addDoc(productRef, p);
          console.log(`‚úÖ Added ${p.name}`);
        } else {
          console.log(`‚ö†Ô∏è Skipped ${p.name} (already exists)`);
        }
      }

      alert("üéâ Sample products loaded!");
      loadProducts();
    };

    // Load products on page load
    loadProducts();
  </script>
</body>
</html>
